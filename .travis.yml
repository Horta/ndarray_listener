language: python
matrix:
  include:
  - os: linux
    sudo: false
    dist: trusty
    python: '2.7'
  - os: linux
    sudo: false
    dist: trusty
    python: '3.4'
  - os: linux
    sudo: false
    dist: trusty
    python: '3.5'
  - os: osx
    language: generic
    env: TRAVIS_PYTHON_VERSION=3.5
before_install:
- wget https://raw.githubusercontent.com/Horta/travis-miniconda/master/install.sh
  -O install.sh
- chmod +x install.sh
- travis_retry bash -x ./install.sh
install:
- export PATH="$HOME/miniconda/bin:$PATH"
- source activate travisci
- travis_retry conda install pycparser -y --name travisci
before_script:
- export PATH="$HOME/miniconda/bin:$PATH"
- source activate travisci
- python setup.py test
script:
- export PATH="$HOME/miniconda/bin:$PATH"
- source activate travisci
- python setup.py sdist
- pip install dist/`ls dist | grep -i -E '\.(gz)$' | head -1`
- pushd /
- python -c "import ndarray_listener; ndarray_listener.test()"
- popd
deploy:
  provider: pypi
  skip_cleanup: true
  user: danilo.horta
  password:
    secure: F+iHQuyhnSP3QLq0v2AULvRMifHFUtxmWYbp17YxBHRlxRwtQY61fnQz0JKGkuUEHIwE0Ap+UxM27dplK6d8GGeOvS67ucCtf0iHD12+Ai/UbFWn43DoFdEaFY0uIGnteQSdNp2d4f4x2Zh2biFQL1XBgGGOEV2UGEX/1GpjDhWnUHo0pAl83c8U45NN2NK6go4Iq1dZdFINGkQ8vgojP47hMzq899IFMm6C0ZfCs3j0XaZD73ZZWgCCpPvp+guehdAlisaBt1gDaN4Xs33qoSaYuiKkObnsxN9nbrpzB3pDtzilGByr9dggIqXLaFUKl7/IMexVnKmIJ3s7wvE7mLhVrddUqp4SIXlvuNA9+g9JOjcuwKl7f3r/l03qllIkh1eMsKI7W/+7rJQAczRtR7UWXbpHD8tCaGazf72Qsm428gXT8+d9vgkO5wRZMn4hXL7sOEtNF+aBXJuzMnkEkDx+Aggy8RZFXTvEzKnl/N7aXj+n7GC+SFrLcbudMJV3iXsCP+9W5FylHgOeu0cPNJmjLA8CLl9jiPJXsMUDBTuFrtpvlTpLw4yTD/7Gz+n7U4egJ+PRBNPtw4EAeAYtKi1j4tmYrz6B6yzFp2tflCwaVwTOToO0tNRh28lxCHx2bhAcm+v0SttjpsNSS0XJEV1MzXWIuQp6nGblZXeqTh4=
  on:
    branch: master
notifications:
  email: false
